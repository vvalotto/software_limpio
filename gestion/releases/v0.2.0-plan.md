# Plan de Release v0.2.0 ‚Äî DesignReviewer

**Estado:** üîÑ Planificaci√≥n
**Tipo:** GitHub Release
**Tag:** `v0.2.0`
**Alcance:** Implementaci√≥n completa de DesignReviewer ‚Äî an√°lisis de calidad de dise√±o sobre el delta de un PR

---

## Contexto

DesignReviewer es el segundo agente de la trilog√≠a. Analiza la **calidad de dise√±o del conjunto de cambios que se van a mergear** (delta del PR), no el proyecto completo. A diferencia de CodeGuard (que nunca bloquea), DesignReviewer **puede bloquear el merge** si detecta violaciones cr√≠ticas.

### Decisiones de dise√±o acordadas

- **Scope:** solo los archivos modificados en el PR (delta), m√°s dependencias directas
- **M√©tricas:** relaciones entre elementos ‚Äî no m√©tricas de archivo individual (esas son de CodeGuard)
- **Modelo de datos:** tipos propios (`ReviewResult`, `ReviewSeverity`) ‚Äî comparte solo `Verifiable` de `shared/`
- **IA:** opt-in (el agente funciona completo sin ella)
- **Deuda t√©cnica:** `estimated_effort` (horas) como atributo de cada resultado

### M√©tricas a implementar

| # | M√©trica | Principio SOLID | Severidad | Herramienta |
|---|---------|----------------|-----------|-------------|
| 1 | CBO (Coupling Between Objects) | ISP / DIP | CRITICAL | AST propio |
| 2 | Fan-Out | ISP / DIP | WARNING | AST propio |
| 3 | Importaciones circulares | DIP | CRITICAL | AST propio |
| 4 | DIT (Depth of Inheritance Tree) | ‚Äî | CRITICAL | AST propio |
| 5 | NOP (Number of Parents) | ‚Äî | CRITICAL | AST propio |
| 6 | LCOM (Lack of Cohesion of Methods) | SRP | WARNING | AST propio |
| 7 | WMC (Weighted Methods per Class) | SRP | CRITICAL | radon |
| 8 | Code Smells de dise√±o + SOLID | SRP / OCP / LSP | CRITICAL/WARNING | AST propio + IA |

---

## Fase 1 ‚Äî Infraestructura Base

**Objetivo:** Reemplazar el skeleton actual por la arquitectura modular correcta.

- [ ] **1.1** Crear `designreviewer/analyzers/` con `__init__.py` documentado
- [ ] **1.2** Definir `ReviewSeverity` (INFO / WARNING / CRITICAL) y `ReviewResult` (con `estimated_effort`) en `agent.py`
- [ ] **1.3** Refactorizar `DesignReviewer` como clase principal que delega en `AnalyzerOrchestrator`
- [ ] **1.4** Implementar `AnalyzerOrchestrator` con auto-discovery (mismo patr√≥n que `CheckOrchestrator`)
- [ ] **1.5** Definir configuraci√≥n `[tool.designreviewer]` en `pyproject.toml` con umbrales por m√©trica
- [ ] **1.6** Eliminar `analyzers.py` (funciones sueltas) ‚Äî reemplazado por `analyzers/`
- [ ] **1.7** Tests unitarios de infraestructura (orchestrator, config, tipos)

**Criterio de cierre:** `AnalyzerOrchestrator` instancia y descubre analyzers vac√≠os sin errores.

---

## Fase 2 ‚Äî Analyzers de Acoplamiento

**Objetivo:** Implementar los tres analyzers que detectan dependencias problem√°ticas.

- [ ] **2.1** `CBOAnalyzer` ‚Äî cuenta clases distintas que usa cada clase del changeset (umbral: 5)
- [ ] **2.2** `FanOutAnalyzer` ‚Äî cuenta m√≥dulos importados por archivo (umbral: 7)
- [ ] **2.3** `CircularImportsAnalyzer` ‚Äî detecta ciclos introducidos por el changeset
- [ ] **2.4** Implementar c√°lculo de `estimated_effort` para cada uno (f√≥rmula basada en magnitud de violaci√≥n)
- [ ] **2.5** Tests unitarios para cada analyzer (con fixtures de c√≥digo Python sint√©tico)

**Criterio de cierre:** Los 3 analyzers detectan violaciones correctamente en c√≥digo de prueba.

---

## Fase 3 ‚Äî Analyzers de Cohesi√≥n y Herencia

**Objetivo:** Implementar m√©tricas sobre la estructura interna de las clases.

- [ ] **3.1** `LCOMAnalyzer` ‚Äî m√©todos que no comparten atributos con el resto de la clase (umbral: 1)
- [ ] **3.2** `WMCAnalyzer` ‚Äî suma de CC de todos los m√©todos de la clase via radon (umbral: 20)
- [ ] **3.3** `DITAnalyzer` ‚Äî profundidad del √°rbol de herencia (umbral: 5)
- [ ] **3.4** `NOPAnalyzer` ‚Äî n√∫mero de clases padre directas (umbral: 1)
- [ ] **3.5** Implementar `estimated_effort` para cada uno
- [ ] **3.6** Tests unitarios para cada analyzer

**Criterio de cierre:** Los 4 analyzers detectan violaciones correctamente en c√≥digo de prueba.

---

## Fase 4 ‚Äî Code Smells y Principios SOLID

**Objetivo:** Detectar patrones problem√°ticos de dise√±o que no se expresan como m√©tricas num√©ricas.

- [ ] **4.1** Definir cat√°logo de smells a detectar (God Object, Feature Envy, Data Clumps, otros)
- [ ] **4.2** Implementar detecci√≥n de smells v√≠a AST para cada uno del cat√°logo
- [ ] **4.3** Mapear cada smell a su violaci√≥n SOLID correspondiente
- [ ] **4.4** Definir severidad y `estimated_effort` por tipo de smell
- [ ] **4.5** Tests unitarios para cada smell

**Criterio de cierre:** Al menos 3 smells detectables con tests que demuestran verdaderos positivos y negativos.

---

## Fase 5 ‚Äî CLI y Output

**Objetivo:** CLI funcional con salida Rich similar a CodeGuard.

- [ ] **5.1** Implementar CLI `designreviewer` con Click (target path, --format, --config, --no-ai)
- [ ] **5.2** Implementar formatter Rich: panel de BLOCKING ISSUES y WARNINGS separados
- [ ] **5.3** Mostrar `estimated_effort` total del changeset al final del reporte
- [ ] **5.4** Implementar salida JSON estructurada (mismo patr√≥n que CodeGuard)
- [ ] **5.5** Exit code: 1 si hay CRITICAL, 0 si solo WARNING o limpio
- [ ] **5.6** Tests de integraci√≥n del CLI

**Criterio de cierre:** `designreviewer src/` produce output correcto en terminal y JSON.

---

## Fase 6 ‚Äî Integraci√≥n IA (opt-in)

**Objetivo:** Enriquecer los resultados con sugerencias de Claude cuando est√° disponible.

- [ ] **6.1** Implementar `AIAssistant` funcional (llamada real a Claude API)
- [ ] **6.2** Definir prompts por tipo de analyzer: explicaci√≥n + sugerencia de refactoring + c√≥digo ejemplo
- [ ] **6.3** Integrar `AIAssistant` en `DesignReviewer` (solo si `ai.enabled = true` y `ANTHROPIC_API_KEY` presente)
- [ ] **6.4** Refinar `estimated_effort` con contexto de IA cuando est√° disponible
- [ ] **6.5** Tests de integraci√≥n con mock de Claude API

**Criterio de cierre:** Con `ai.enabled = true`, los resultados incluyen sugerencias de refactoring.

---

## Fase 7 ‚Äî Tests Completos y Documentaci√≥n

**Objetivo:** Cobertura de tests adecuada y documentaci√≥n de usuario lista para release.

- [ ] **7.1** Tests de integraci√≥n end-to-end (proyecto temporal con violaciones conocidas)
- [ ] **7.2** Tests E2E del CLI completo
- [ ] **7.3** Dogfooding: correr `designreviewer src/` sobre el propio c√≥digo del proyecto
- [ ] **7.4** Crear `docs/guias/designreviewer.md` ‚Äî gu√≠a de usuario
- [ ] **7.5** Actualizar `README.md` ‚Äî secci√≥n DesignReviewer
- [ ] **7.6** Actualizar `CHANGELOG.md` con secci√≥n `[0.2.0]`
- [ ] **7.7** Verificar que `pyproject.toml` tiene `version = "0.2.0"`

---

## Fase 8 ‚Äî Release

**Objetivo:** Publicar v0.2.0 como GitHub Release.

- [ ] **8.1** Suite completa de tests ‚Äî `pytest` (objetivo: ~450 tests)
- [ ] **8.2** Linting ‚Äî `ruff check src/ tests/`
- [ ] **8.3** Tipos ‚Äî `mypy src/`
- [ ] **8.4** Build limpio ‚Äî `python -m build` + `twine check dist/*`
- [ ] **8.5** Crear tag `v0.2.0` y push
- [ ] **8.6** Crear GitHub Release con artefactos

---

## Criterios de √©xito de la release

- Todos los 8 analyzers funcionales y testeados
- CLI `designreviewer` operativa con salida Rich y JSON
- Exit code correcto (bloquea si hay CRITICAL)
- ~450 tests pasando (~150 nuevos respecto a v0.1.0)
- Dogfooding: `designreviewer src/` corre sin errores sobre el propio proyecto
- GitHub Release publicada con artefactos
